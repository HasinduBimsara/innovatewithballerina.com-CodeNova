<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaskSwap - Home</title>
    <style>
      body {
        font-family: "Arial", sans-serif;
        margin: 0;
        padding: 2rem;
        background: #f9fafb;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 2rem;
        border-radius: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .header {
        text-align: center;
        margin-bottom: 2rem;
      }
      .user-info {
        background: #e0f2fe;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 2rem;
      }
      .btn {
        background: #2563eb;
        color: white;
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
        margin: 0.5rem;
      }
      .btn:hover {
        background: #1d4ed8;
      }
      .nav-links {
        text-align: center;
        margin-bottom: 2rem;
      }
      .nav-links a {
        margin: 0 1rem;
        color: #2563eb;
        text-decoration: none;
        font-weight: 500;
      }
      .nav-links a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üîÑ TaskSwap</h1>
        <p>Welcome to your TaskSwap dashboard</p>
      </div>

      <div class="nav-links">
        <a href="/signup">Sign Up</a>
        <a href="/login">Login</a>
        <button class="btn" onclick="checkUsers()">View All Users</button>
        <button class="btn" onclick="logout()">Logout</button>
      </div>

      <div id="user-info" class="user-info" style="display: none">
        <h3>üë§ User Information</h3>
        <p><strong>Name:</strong> <span id="user-name"></span></p>
        <p><strong>Email:</strong> <span id="user-email"></span></p>
        <p><strong>Role:</strong> <span id="user-role"></span></p>
      </div>

      <div id="content">
        <h2>üéØ Getting Started</h2>
        <p>Welcome to TaskSwap! Here's what you can do:</p>

        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
          "
        >
          <div style="background: #f0f9ff; padding: 1.5rem; border-radius: 8px">
            <h3>üìù For Task Givers</h3>
            <p>
              Post tasks you need help with and find skilled people to complete
              them.
            </p>
          </div>

          <div style="background: #f0fdf4; padding: 1.5rem; border-radius: 8px">
            <h3>üîç For Task Seekers</h3>
            <p>
              Browse available tasks and earn money using your skills and
              expertise.
            </p>
          </div>
        </div>
      </div>

      <div id="users-list" style="display: none">
        <h2>üë• Registered Users</h2>
        <div id="users-container"></div>
      </div>

      <div
        id="status"
        style="
          margin-top: 2rem;
          padding: 1rem;
          background: #f3f4f6;
          border-radius: 8px;
        "
      >
        <h3>üîß System Status</h3>
        <p>
          <strong>Backend:</strong> <span id="backend-status">Checking...</span>
        </p>
        <p>
          <strong>Database:</strong> <span id="db-status">Checking...</span>
        </p>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      const API_BASE_URL = "http://localhost:8081/api";

      // Check authentication status
      function checkAuth() {
        const token = localStorage.getItem("taskswap_token");
        const user = localStorage.getItem("taskswap_user");

        if (token && user) {
          try {
            const userData = JSON.parse(user);
            console.log("üë§ User logged in:", userData);

            // Show user info
            document.getElementById("user-info").style.display = "block";
            document.getElementById("user-name").textContent =
              userData.fullname || "N/A";
            document.getElementById("user-email").textContent =
              userData.email || "N/A";
            document.getElementById("user-role").textContent =
              userData.role || "N/A";

            return true;
          } catch (error) {
            console.error("‚ùå Error parsing user data:", error);
            localStorage.removeItem("taskswap_token");
            localStorage.removeItem("taskswap_user");
          }
        }

        console.log("üîí User not authenticated");
        return false;
      }

      // Logout function
      function logout() {
        console.log("üëã Logging out user...");

        const token = localStorage.getItem("taskswap_token");

        // Clear local storage
        localStorage.removeItem("taskswap_token");
        localStorage.removeItem("taskswap_user");

        // Hide user info
        document.getElementById("user-info").style.display = "none";

        // Optional: Call logout endpoint
        if (token) {
          axios
            .post(
              `${API_BASE_URL}/logout`,
              {},
              {
                headers: {
                  Authorization: `Bearer ${token}`,
                },
              }
            )
            .then((response) => {
              console.log("‚úÖ Logout successful:", response.data);
            })
            .catch((error) => {
              console.warn("‚ö†Ô∏è Logout request failed:", error.message);
            });
        }

        alert("Logged out successfully!");
        location.reload();
      }

      // Check users function
      async function checkUsers() {
        try {
          console.log("üë• Fetching users...");
          const response = await axios.get(`${API_BASE_URL}/users`);

          if (response.data.success) {
            const users = response.data.users;
            const usersContainer = document.getElementById("users-container");
            const usersList = document.getElementById("users-list");

            if (users.length === 0) {
              usersContainer.innerHTML = "<p>No users found.</p>";
            } else {
              usersContainer.innerHTML = users
                .map(
                  (user) => `
              <div style="background: white; padding: 1rem; margin: 0.5rem 0; border-radius: 8px; border: 1px solid #e5e7eb;">
                <strong>${user.fullname}</strong> (${user.email})<br>
                <small>Role: ${user.role} | Created: ${new Date(
                    user.createdAt
                  ).toLocaleDateString()}</small>
              </div>
            `
                )
                .join("");
            }

            usersList.style.display = "block";
            usersList.scrollIntoView({ behavior: "smooth" });
          } else {
            alert("Failed to fetch users: " + response.data.message);
          }
        } catch (error) {
          console.error("‚ùå Error fetching users:", error);
          alert("Error fetching users: " + error.message);
        }
      }

      // Check backend status
      async function checkBackendStatus() {
        try {
          console.log("üîç Checking backend status...");
          const response = await axios.get(`${API_BASE_URL}/health`);

          document.getElementById("backend-status").textContent =
            "‚úÖ Connected";
          document.getElementById("backend-status").style.color = "#10b981";

          if (response.data.database) {
            document.getElementById(
              "db-status"
            ).textContent = `‚úÖ ${response.data.database} (${response.data.users_count} users)`;
            document.getElementById("db-status").style.color = "#10b981";
          }

          console.log("‚úÖ Backend health check:", response.data);
        } catch (error) {
          console.warn("‚ö†Ô∏è Backend connection failed:", error.message);
          document.getElementById("backend-status").textContent =
            "‚ùå Disconnected";
          document.getElementById("backend-status").style.color = "#ef4444";
          document.getElementById("db-status").textContent = "‚ùå Unavailable";
          document.getElementById("db-status").style.color = "#ef4444";
        }
      }

      // Initialize page
      window.addEventListener("load", function () {
        console.log("üöÄ TaskSwap Home Page Loaded");

        // Check authentication
        checkAuth();

        // Check backend status
        checkBackendStatus();

        // Auto-refresh status every 30 seconds
        setInterval(checkBackendStatus, 30000);
      });

      // Add some interactive features
      document.addEventListener("DOMContentLoaded", function () {
        // Add click handlers for navigation
        const signupLink = document.querySelector('a[href="/signup"]');
        const loginLink = document.querySelector('a[href="/login"]');

        if (signupLink) {
          signupLink.addEventListener("click", function (e) {
            e.preventDefault();
            window.location.href = "/signup";
          });
        }

        if (loginLink) {
          loginLink.addEventListener("click", function (e) {
            e.preventDefault();
            window.location.href = "/login";
          });
        }
      });
    </script>
  </body>
</html>
